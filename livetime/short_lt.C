using namespace std;
const Int_t NRUNS = 521;

void lt_petermethod(){
  ofstream txtfile("live_time.txt",ios::app);
  gROOT->SetBatch(kTRUE);

  
    gStyle->SetOptStat(1111111);

    TFile *f[NRUNS];

    TTree *t[NRUNS];
    TTree *u[NRUNS];
    TTree *v[NRUNS];

    TH1D *h1[NRUNS];
    TH1D *h2[NRUNS];
    
    Double_t pcharge_1[NRUNS];
    Double_t pTime[NRUNS];
    Double_t pcurrent_1[NRUNS];
	
    Double_t pchargeCut_1[NRUNS];
    Double_t pTimeCut[NRUNS];
    Double_t pcurrentCut_1[NRUNS];	
	
    Double_t pedtmtrig[NRUNS];
    Double_t pedtmtrig_accptd[NRUNS];	
    Double_t plt_err[NRUNS];	
    Double_t ptrig1_rate[NRUNS];	
    Double_t fac[NRUNS];	
    Double_t pold_lt[NRUNS];	

    Double_t pnew_lt[NRUNS];	

	///////////
	
    Double_t hcharge_1[NRUNS];
    Double_t hTime[NRUNS];
    Double_t hcurrent_1[NRUNS];

    Double_t hchargeCut_1[NRUNS];
    Double_t hTimeCut[NRUNS];
    Double_t hcurrentCut_1[NRUNS];

    Double_t hedtmtrig[NRUNS];
    Double_t hedtmtrig_accptd[NRUNS];
    Double_t hlt_err[NRUNS];

    Double_t hnew_lt[NRUNS];	

    Double_t runs[NRUNS] = {6020, 6021, 6022, 6026, 6027, 6028, 6029, 6030, 6031, 6032, 6043, 6044, 6045, 6046, 6049, 6050, 6051, 6052, 6053, 6054, 6055, 6056, 6057, 6058, 6067, 6068, 6070, 6071, 6080, 6081, 6087, 6088, 6089, 6090, 6091, 6093, 6094, 6095, 6096, 6097, 6098, 6109, 6110, 6111, 6112, 6114, 6115, 6116, 6119, 6120, 6124, 6125, 6127, 6128, 6129, 6130, 6132, 6133, 6135, 6136, 6137, 6138, 6145, 6146, 6154, 6155, 6166, 6168, 6169, 6170, 6171, 6172, 6179, 6180, 6181, 6182, 6183, 6184, 6185, 6186, 6187, 6194, 6195, 6196, 6197, 6198, 6199, 6205, 6208, 6209, 6210, 6211, 6212, 6213, 6214, 6215, 6216, 6217, 6219, 6220, 6242, 6243, 6244, 6245, 6246, 6247, 6248, 6249, 6250, 6251, 6252, 6261, 6262, 6263, 6264, 6265, 6266, 6267, 6270, 6271, 6272, 6273, 6274, 6275, 6276, 6277, 6288, 6289, 6290, 6291, 6292, 6293, 6294, 6295, 6296, 6304, 6305, 6306, 6307, 6308, 6309, 6310, 6311, 6312, 6317, 6318, 6322, 6323, 6325, 6326, 6327, 6328, 6329, 6339, 6340, 6341, 6342, 6343, 6344, 6345, 6346, 6347, 6348, 6349, 6350, 6351, 6352, 6353, 6354, 6359, 6360, 6363, 6364, 6365, 6367, 6368, 6370, 6371, 6372, 6373, 6374, 6375, 6376, 6377, 6378, 6379, 6380, 6381, 6382, 6383, 6385, 6386, 6387, 6388, 6389, 6390, 6391, 6393, 6394, 6395, 6396, 6397, 6398, 6399, 6400, 6401, 6402, 6403, 6404, 6405, 6406, 6407, 6408, 6410, 6411, 6412, 6413, 6415, 6416, 6417, 6419, 6421, 6422, 6423, 6425, 6426, 6427, 6428, 6429, 6430, 6431, 6432, 6433, 6434, 6435, 6436, 6439, 6440, 6441, 6442, 6443, 6444, 6445, 6446, 6447, 6448, 6451, 6452, 6453, 6454, 6455, 6456, 6459, 6460, 6461, 6462, 6463, 6464, 6465, 6466, 6467, 6468, 6469, 6470, 6471, 6472, 6473, 6474, 6475, 6476, 6477, 6478, 6479, 6482, 6483, 6484, 6485, 6486, 6487, 6488, 6489, 6490, 6491, 6493, 6494, 6495, 6496, 6497, 6498, 6499, 6500, 6501, 6502, 6503, 6504, 6506, 6507, 6509, 6510, 6512, 6513, 6514, 6515, 6516, 6517, 6518, 6519, 6520, 6521, 6522, 6523, 6524, 6525, 6526, 6527, 6528, 6529, 6531, 6532, 6533, 6534, 6535, 6536, 6537, 6538, 6539, 6541, 6542, 6543, 6544, 6545, 6546, 6547, 6548, 6549, 6550, 6551, 6552, 7593, 7594, 7595, 7596, 7597, 7599, 7600, 7601, 7602, 7603, 7604, 7605, 7606, 7607, 7608, 7609, 7610, 7611, 7612, 7613, 7614, 7615, 7616, 7617, 7618, 7619, 7620, 7621, 7622, 7623, 7625, 7626, 7627, 7628, 7629, 7630, 7631, 7632, 7633, 7634, 7635, 7636, 7637, 7638, 7639, 7640, 7641, 7642, 7643, 7644, 7645, 7646, 7647, 7648, 7649, 7650, 7651, 7652, 7654, 7655, 7657, 7658, 7659, 7660, 7661, 7662, 7663, 7666, 7667, 7668, 7669, 7670, 7671, 7672, 7673, 7674, 7675, 7676, 7677, 7678, 7679, 7680, 7681, 7682, 7684, 7685, 7686, 7687, 7688, 7689, 7690, 7692, 7694, 7695, 7697, 7698, 7699, 7702, 7703, 7706, 7707, 7708, 7709, 7710, 7711, 7712, 7713, 7714, 7715, 7716, 7717, 7718, 7719, 7720, 7721, 7722, 7724, 7725, 7727, 7728, 7735, 7736, 7737, 7738, 7739, 7740, 7747, 7748, 7749, 7750, 7751, 7752, 7757, 7758, 7759, 7760, 7762, 7768, 7769, 7770, 7771, 7772, 7773, 7774, 7775, 7776, 7777, 7783, 7784, 7785, 7786, 7787, 7790, 7791, 7792, 7793, 7794, 7796, 7797, 7798, 7799, 7800, 7801, 7802, 7803, 7804, 7805, 7806, 7807, 7808, 7809, 7811, 7812, 7813, 7814, 7815, 7816, 7817, 7819, 7820};
//6073 removed
    Int_t rruns[NRUNS] =  {6020, 6021, 6022, 6026, 6027, 6028, 6029, 6030, 6031, 6032, 6043, 6044, 6045, 6046, 6049, 6050, 6051, 6052, 6053, 6054, 6055, 6056, 6057, 6058, 6067, 6068, 6070, 6071, 6080, 6081, 6087, 6088, 6089, 6090, 6091, 6093, 6094, 6095, 6096, 6097, 6098, 6109, 6110, 6111, 6112, 6114, 6115, 6116, 6119, 6120, 6124, 6125, 6127, 6128, 6129, 6130, 6132, 6133, 6135, 6136, 6137, 6138, 6145, 6146, 6154, 6155, 6166, 6168, 6169, 6170, 6171, 6172, 6179, 6180, 6181, 6182, 6183, 6184, 6185, 6186, 6187, 6194, 6195, 6196, 6197, 6198, 6199, 6205, 6208, 6209, 6210, 6211, 6212, 6213, 6214, 6215, 6216, 6217, 6219, 6220, 6242, 6243, 6244, 6245, 6246, 6247, 6248, 6249, 6250, 6251, 6252, 6261, 6262, 6263, 6264, 6265, 6266, 6267, 6270, 6271, 6272, 6273, 6274, 6275, 6276, 6277, 6288, 6289, 6290, 6291, 6292, 6293, 6294, 6295, 6296, 6304, 6305, 6306, 6307, 6308, 6309, 6310, 6311, 6312, 6317, 6318, 6322, 6323, 6325, 6326, 6327, 6328, 6329, 6339, 6340, 6341, 6342, 6343, 6344, 6345, 6346, 6347, 6348, 6349, 6350, 6351, 6352, 6353, 6354, 6359, 6360, 6363, 6364, 6365, 6367, 6368, 6370, 6371, 6372, 6373, 6374, 6375, 6376, 6377, 6378, 6379, 6380, 6381, 6382, 6383, 6385, 6386, 6387, 6388, 6389, 6390, 6391, 6393, 6394, 6395, 6396, 6397, 6398, 6399, 6400, 6401, 6402, 6403, 6404, 6405, 6406, 6407, 6408, 6410, 6411, 6412, 6413, 6415, 6416, 6417, 6419, 6421, 6422, 6423, 6425, 6426, 6427, 6428, 6429, 6430, 6431, 6432, 6433, 6434, 6435, 6436, 6439, 6440, 6441, 6442, 6443, 6444, 6445, 6446, 6447, 6448, 6451, 6452, 6453, 6454, 6455, 6456, 6459, 6460, 6461, 6462, 6463, 6464, 6465, 6466, 6467, 6468, 6469, 6470, 6471, 6472, 6473, 6474, 6475, 6476, 6477, 6478, 6479, 6482, 6483, 6484, 6485, 6486, 6487, 6488, 6489, 6490, 6491, 6493, 6494, 6495, 6496, 6497, 6498, 6499, 6500, 6501, 6502, 6503, 6504, 6506, 6507, 6509, 6510, 6512, 6513, 6514, 6515, 6516, 6517, 6518, 6519, 6520, 6521, 6522, 6523, 6524, 6525, 6526, 6527, 6528, 6529, 6531, 6532, 6533, 6534, 6535, 6536, 6537, 6538, 6539, 6541, 6542, 6543, 6544, 6545, 6546, 6547, 6548, 6549, 6550, 6551, 6552, 7593, 7594, 7595, 7596, 7597, 7599, 7600, 7601, 7602, 7603, 7604, 7605, 7606, 7607, 7608, 7609, 7610, 7611, 7612, 7613, 7614, 7615, 7616, 7617, 7618, 7619, 7620, 7621, 7622, 7623, 7625, 7626, 7627, 7628, 7629, 7630, 7631, 7632, 7633, 7634, 7635, 7636, 7637, 7638, 7639, 7640, 7641, 7642, 7643, 7644, 7645, 7646, 7647, 7648, 7649, 7650, 7651, 7652, 7654, 7655, 7657, 7658, 7659, 7660, 7661, 7662, 7663, 7666, 7667, 7668, 7669, 7670, 7671, 7672, 7673, 7674, 7675, 7676, 7677, 7678, 7679, 7680, 7681, 7682, 7684, 7685, 7686, 7687, 7688, 7689, 7690, 7692, 7694, 7695, 7697, 7698, 7699, 7702, 7703, 7706, 7707, 7708, 7709, 7710, 7711, 7712, 7713, 7714, 7715, 7716, 7717, 7718, 7719, 7720, 7721, 7722, 7724, 7725, 7727, 7728, 7735, 7736, 7737, 7738, 7739, 7740, 7747, 7748, 7749, 7750, 7751, 7752, 7757, 7758, 7759, 7760, 7762, 7768, 7769, 7770, 7771, 7772, 7773, 7774, 7775, 7776, 7777, 7783, 7784, 7785, 7786, 7787, 7790, 7791, 7792, 7793, 7794, 7796, 7797, 7798, 7799, 7800, 7801, 7802, 7803, 7804, 7805, 7806, 7807, 7808, 7809, 7811, 7812, 7813, 7814, 7815, 7816, 7817, 7819, 7820};

    //	cout<<" "<<endl;
    //	cout<<"  "<<"runs"<<"      "<<"current"<<"      "<<"current_cut"<<"      "<<"edtmtrig"<<"      "<<"edtmtrig_accptd"<<"      "<<"live_time"<<endl;
    //	cout<<" "<<endl;

    for (Int_t i=0;i<NRUNS;i++){

      //f[i]=new TFile(Form("/home/hdbhatt/Desktop/my_analysis/tracking/bdcode/coin_replay_production_%d_-1.root",rruns[i]),"read");

	f[i]=new TFile(Form("/lustre19/expphy/volatile/hallc/spring17/hdbhatt/group/ROOTfiles/livetime/coin_replay_production_%d_-1.root",rruns[i]),"read");
        t[i]= (TTree*)f[i]->Get("TSP");
        u[i]= (TTree*)f[i]->Get("TSH");
        v[i]= (TTree*)f[i]->Get("T");

	//cout<< "Opening Run Num = "<< rruns[i] <<endl; 

  if(f[i]->IsZombie()){
      std::cout << "Error opening file "<< std::endl;
     // exit(-1);
      continue;
    }

	
        auto nEntries1 = t[i]->GetEntries();
        t[i]->GetEntry(nEntries1 -1);

        h1[i] = new TH1D("h1[i]","pedtmtrig_accptd",100,0.,100000.);

        pcharge_1[i] = t[i]->GetLeaf("P.BCM1.scalerCharge")->GetValue()/1000.0; // charge in mC
        pTime[i] = t[i]->GetLeaf("P.1MHz.scalerTime")->GetValue(); // Time in s
        pcurrent_1[i] = pcharge_1[i]*1000.0/pTime[i];//current in uA
		
        pchargeCut_1[i] = t[i]->GetLeaf("P.BCM1.scalerChargeCut")->GetValue()/1000.0; // charge in mC
        pTimeCut[i] = t[i]->GetLeaf("P.1MHz.scalerTimeCut")->GetValue(); // Time in s
        pcurrentCut_1[i] = pchargeCut_1[i]*1000.0/pTimeCut[i];//current in uA
	fac[i] =  pcurrent_1[i] /  pcurrentCut_1[i];
        pedtmtrig[i] = t[i]->GetLeaf("P.EDTM.scaler")->GetValue();//SHMS EDTM Trigger
        ptrig1_rate[i] = t[i]->GetLeaf("P.pTRIG1.scalerRate")->GetValue()/1000.0;//

        v[i]->Draw("T.coin.pEDTM_tdcTime>>h1[i]","T.coin.pEDTM_tdcTime!=0","goff");//SHMS EDTM Trigger Accepted
        pedtmtrig_accptd[i] = h1[i]->GetEntries();//SHMS EDTM Trigger Accepted
	pold_lt[i] =  pedtmtrig_accptd[i]/pedtmtrig[i];

    plt_err[i]= (1/pedtmtrig[i]) * sqrt(pedtmtrig_accptd[i]*(1-  pedtmtrig_accptd[i]/pedtmtrig[i] ));
//	plt_err[i] = sqrt(pedtmtrig_accptd[i]) / (pedtmtrig[i]);
			   
        pnew_lt[i] = ((pedtmtrig_accptd[i]/pedtmtrig[i])-(1.-(pcurrent_1[i]/pcurrentCut_1[i])))/(pcurrent_1[i]/pcurrentCut_1[i]);

		//////////////
		
	/* auto nEntries2 = u[i]->GetEntries();
        u[i]->GetEntry(nEntries2 -1);

        h2[i] = new TH1D("h2[i]","hedtmtrig_accptd",100,0.,100000.);

        hcharge_1[i] = u[i]->GetLeaf("H.BCM1.scalerCharge")->GetValue()/1000.0; // charge in mC
        hTime[i] = u[i]->GetLeaf("H.1MHz.scalerTime")->GetValue(); // Time in s
        hcurrent_1[i] = hcharge_1[i]*1000.0/hTime[i];//current in uA
		
        hchargeCut_1[i] = u[i]->GetLeaf("H.BCM1.scalerChargeCut")->GetValue()/1000.0; // charge in mC
        hTimeCut[i] = u[i]->GetLeaf("H.1MHz.scalerTimeCut")->GetValue(); // Time in s
        hcurrentCut_1[i] = hchargeCut_1[i]*1000.0/hTimeCut[i];//current in uA

        hedtmtrig[i] = u[i]->GetLeaf("H.EDTM.scaler")->GetValue();//HMS EDTM Trigger
        v[i]->Draw("T.coin.hEDTM_tdcTime>>h2[i]","T.coin.hEDTM_tdcTime!=0","goff");//HMS EDTM Trigger Accepted
        hedtmtrig_accptd[i] = h2[i]->GetEntries();//HMS EDTM Trigger Accepted

        hnew_lt[i] = ((hedtmtrig_accptd[i]/hedtmtrig[i])-(1.-(hcurrent_1[i]/hcurrentCut_1[i])))/(hcurrent_1[i]/hcurrentCut_1[i]);
	*/		
		//cout<<"  "<<runs[i]<<"      "<<pnew_lt[i]<<"      "<<hnew_lt[i]<<endl;

	//	cout<<"  "<<runs[i]<<"      "<<pcurrent_1[i]<<"      "<<pcurrentCut_1[i]<<"      "<<fac[i]<<"      "<<pedtmtrig[i]<<"      "<<pedtmtrig_accptd[i]<<"      "<<pold_lt[i]<<"      "<<pnew_lt[i]<<"      "<< plt_err[i] <<"      "<<ptrig1_rate[i]<<""<< endl;

	txtfile<<"  "<<runs[i]<<"      "<<pcurrent_1[i]<<"      "<<pcurrentCut_1[i]<<"      "<<fac[i]<<"      "<<pedtmtrig[i]<<"      "<<pedtmtrig_accptd[i]<<"      "<<pold_lt[i]<<"      "<<pnew_lt[i]<<"      "<< plt_err[i] <<"      "<<ptrig1_rate[i]<<""<< endl;


	
    }
    //	cout<<" "<<endl;
  }
